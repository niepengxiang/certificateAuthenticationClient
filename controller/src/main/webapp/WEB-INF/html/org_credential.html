<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="../../css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
	<div class="modal fade" id="myModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">提示框</h4>
             <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          </div>
          <div class="modal-body">
            <p>内容&hellip;</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            <button type="button" class="btn btn-primary" data-dismiss="modal">确定</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
    <div style="text-align: center;"><h2>机构证书用户信息同步</h2></div>
	<form id="orgCredentialFrom" onsubmit="return submitOrgCredential()">
	<div class="input-group mb-3">
		<div class="input-group-prepend">
			<span class="input-group-text" id="inputGroup-sizing-default">认证源ID：</span>
		</div>
		<input type="text" class="form-control" aria-label="Default" name="authSrcId"
			aria-describedby="inputGroup-sizing-default" required>
	</div>
	<div class="input-group mb-3">
		<div class="input-group-prepend">
			<span class="input-group-text" id="inputGroup-sizing-default">请求操作：</span>
		</div>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<label class="radio-inline">
			<input type="radio" name="reqOpt"  value="i" checked>新增
		</label> 
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<label class="radio-inline"> 
		<input type="radio"name="reqOpt" value="u" >更新
		</label>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<label class="radio-inline"> 
		<input type="radio"name="reqOpt" value="d" >删除
		</label>
	</div>
	<div class="input-group mb-3">
		<div class="input-group-prepend">
			<span class="input-group-text" id="inputGroup-sizing-default">签名数字证书序列号：</span>
		</div>
		<input type="text" class="form-control" aria-label="Default" name="sigCertSn"
			aria-describedby="inputGroup-sizing-default" required>
	</div>
	<div class="input-group mb-3">
		<div class="input-group-prepend">
			<span class="input-group-text" id="inputGroup-sizing-default">加密证书序列号：</span>
		</div>
		<input type="text" class="form-control" aria-label="Default" name = "encCertSn"
			aria-describedby="inputGroup-sizing-default">
	</div>
	<div class="input-group mb-3">
		<div class="input-group-prepend">
			<span class="input-group-text" id="inputGroup-sizing-default">签名证书：</span>
		</div>
		 <textarea class="form-control" aria-label="With textarea" required name="sigCer"></textarea>
	</div>
	<div class="input-group mb-3">
		<div class="input-group-prepend">
			<span class="input-group-text" id="inputGroup-sizing-default">加密证书：</span>
		</div>
		 <textarea class="form-control" aria-label="With textarea" name="encCer"></textarea>
	</div>
	
	
	<div class="input-group mb-3">
		<div class="input-group-prepend">
			<span class="input-group-text" id="inputGroup-sizing-default">数字证书状态：</span>
		</div>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<label class="radio"> <input type="radio"
			name="certStatus"  value="1"
			checked>有效
		</label> 
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<label class="radio"> <input type="radio"
			name="certStatus" value="0">无效
		</label>
	</div>
	<div class="input-group mb-3">
		<div class="input-group-prepend">
			<span class="input-group-text" id="inputGroup-sizing-default">证书颁发者：</span>
		</div>
		<input type="text" class="form-control" aria-label="Default" name="certIssuer"
			aria-describedby="inputGroup-sizing-default" required>
	</div>
	<div class="input-group mb-3">
		<div class="input-group-prepend">
			<span class="input-group-text" id="inputGroup-sizing-default">证书用户类型：</span>
		</div>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<label class="radio-inline">
			<input type="radio" name="certUserTypeID"  value="ORG" checked>机构用户证书
		</label> 
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<label class="radio-inline"> 
		<input type="radio"name="certUserTypeID" value="ORG_PERSON" >业务员用户证书
		</label>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<label class="radio-inline"> 
		<input type="radio"name="certUserTypeID" value="PERSON" >个人用户证书
		</label>
	</div>
	<div class="input-group mb-3">
		<div class="input-group-prepend">
			<span class="input-group-text" id="inputGroup-sizing-default">机构编码类型：</span>
		</div>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<label class="radio-inline">
			<input type="radio" name="orgCodeType"  value="1" checked>统一社会信任代码
		</label> 
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<label class="radio-inline"> 
		<input type="radio"name="orgCodeType" value="2" >企业注册号
		</label>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<label class="radio-inline"> 
		<input type="radio"name="orgCodeType" value="0" >其他
		</label>
	</div>
	<div class="input-group mb-3">
		<div class="input-group-prepend">
			<span class="input-group-text" id="inputGroup-sizing-default">机构编码：</span>
		</div>
	 	<textarea class="form-control" aria-label="With textarea" required name="orgCode"></textarea>
	</div>
	<div class="input-group mb-3">
		<div class="input-group-prepend">
			<span class="input-group-text" id="inputGroup-sizing-default">机构名称：</span>
		</div>
		<input type="text" class="form-control" aria-label="Default" name="orgName"
			aria-describedby="inputGroup-sizing-default" required>
	</div>
	<div class="input-group mb-3">
		<div class="input-group-prepend">
			<span class="input-group-text" id="inputGroup-sizing-default">法人名称：</span>
		</div>
		<input type="text" class="form-control" aria-label="Default" required name="legalPerson"
			aria-describedby="inputGroup-sizing-default">
	</div>
	<div class="input-group mb-3">
		<div class="input-group-prepend">
			<span class="input-group-text" id="inputGroup-sizing-default">联系人：</span>
		</div>
		<input type="text" class="form-control" aria-label="Default" required name="contPerson"
			aria-describedby="inputGroup-sizing-default">
	</div>
	<div class="input-group mb-3">
		<div class="input-group-prepend">
			<span class="input-group-text" id="inputGroup-sizing-default">联系人电话：</span>
		</div>
		<input type="text" class="form-control" aria-label="Default" name="contMobile"
			aria-describedby="inputGroup-sizing-default">
	</div>
	
	<div class="input-group mb-3">
		<div class="input-group-prepend">
			<span class="input-group-text" id="inputGroup-sizing-default">机构地址：</span>
		</div>
		<input type="text" class="form-control" aria-label="Default" name="postalCode"
			aria-describedby="inputGroup-sizing-default">
	</div>
	<div class="input-group mb-3">
		<div class="input-group-prepend">
			<span class="input-group-text" id="inputGroup-sizing-default">机构编码：</span>
		</div>
		<textarea class="form-control" aria-label="With textarea" required name="address"></textarea>
	</div>
	<div class="input-group mb-3">
		<div class="input-group-prepend">
			<span class="input-group-text" id="inputGroup-sizing-default">所在省份：</span>
		</div>
		<input type="text" class="form-control" aria-label="Default" name="province"
			aria-describedby="inputGroup-sizing-default">
	</div>
	<div class="input-group mb-3">
		<div class="input-group-prepend">
			<span class="input-group-text" id="inputGroup-sizing-default">所在城市：</span>
		</div>
		<input type="text" class="form-control" aria-label="Default" name="city"
			aria-describedby="inputGroup-sizing-default">
	</div>
	<div class="input-group mb-3">
		<div class="input-group-prepend">
			<span class="input-group-text" id="inputGroup-sizing-default">所在区县：</span>
		</div>
		<input type="text" class="form-control" aria-label="Default" name="district"
			aria-describedby="inputGroup-sizing-default">
	</div>
	<div class="input-group mb-3">
		<div class="input-group-prepend">
			<span class="input-group-text" id="inputGroup-sizing-default">电邮地址：</span>
		</div>
			 <input type="email" class="form-control" name="email">
	</div>
	<div style="text-align: center;">
		<button type="submit" class="btn btn-primary">提交</button>
	</div>
</form>
		<script type="text/javascript" src="../../js/jquery-1.11.3.min.js"></script>
		<script type="text/javascript" src="../../js/common.js"></script>
		<script src="../../js/bootstrap.min.js"></script>
		<script type="text/javascript">
		 	var $modal = $('#myModal');
		    function submitOrgCredential(){
				$.ajax({
					url:"/data/orgCredential",
					type:"post",
					data:JSON.stringify($("#orgCredentialFrom").serializeObject()),
					dataType:"text",
					contentType:"application/json;charse=UTF-8",
					success: function(msg){
						var authSrcId = msg.getAuthSrcId;
						var resultState = msg.getResultState;
						var resultStateStr = "";
						var totalNum = msg.getTotalNum;
						var failNum = msg.getFailNum;
						if(resultState == 0){
							resultStateStr = "有部分数据同步失败";
						}else if(resultState == 1){
							resultStateStr = "所有同步成功";
						}else if(resultState == 2){
							resultStateStr = "参数不正确";
						}
						
						var failArr = msg.getFailArr;
						
						
						if(failArr){
							var reqOpt = "";
							var sigCertSn = "";
							var errorCode = "";
							var errorMsg = "";
							$.each(failArr,function(index,value){
								reqOpt = value.getReqOpt;
								sigCerSn = value.getSigCerSn;
								errorCode = value.getErrorCode;
								errorMsg = value.getErrorMsg;
							});
							
							var errorCodeMsg = "";
							if(errorCode == "E000000"){
								errorCodeMsg = "未知异常";
							}else if(errorCode = "E000001"){
								errorCodeMsg = "服务器证书签名验证失败";
							}else if(errorCode = "E000002"){
								errorCodeMsg = "字段不能为空";
							}else if(errorCode = "E000003"){
								errorCodeMsg = "唯一标识的值已存在，不能执行新增操作。";
							}else if(errorCode = "E000004"){
								errorCodeMsg = "唯一标识的值不存在，不能执行更新或删除操作。";
							}
							
							
							$modal.find('.modal-body p').html(
									"认证源ID:" + authSrcId + "</br>"+	  
								  	"同步结果：" +  resultState + "</br>" +
								  	"接收的总条数：" + totalNum + "</br>" +
								  	"处理错误的条数：" + failNum + "</br>" +
								  	"请求操作：" + reqOpt + "</br>" +
								  	"数字证书序列号：" + sigCertSn + "</br>" +
									"实名认证错误编码：" + errorCodeMsg + "</br>" +
									"错误信息：" + 	errorMsg + "</br>"
								  );
							
						}else{
						$modal.find('.modal-body p').html(
								"认证源ID:" + authSrcId + "</br>"+	  
							  	"同步结果：" +  resultState + "</br>" +
							  	"接收的总条数" + totalNum + "</br>" +
							  	"处理错误的条数" + failNum + "</br>" +
							  );
						}
					  $modal.modal({backdrop: 'static'});
					}
				});
				return false;
		}
	</script>
</body>
</html>